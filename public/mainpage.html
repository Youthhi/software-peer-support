<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Main Page</title>

   
    <script src="https://cdn.tailwindcss.com"></script>
    



  </head>
  <body class="bg-gray-100">

<nav class="flex items-center justify-between bg-white px-6 py-4 shadow sticky top-0 z-40">
    <div id="settingsBtn" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-200 cursor-pointer hover:bg-gray-300">
        ‚öôÔ∏è
    </div>

<div class="max-w-md mx-auto relative mb-10">
    <div class="relative group">
        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
            <svg class="w-5 h-5 text-gray-400 group-focus-within:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
        </span>
        <input type="text" id="searchInput" 
            class="w-full py-2.5 pl-10 pr-4 bg-gray-100 border-transparent rounded-lg focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all" 
            placeholder="Search accounts...">
    </div>

    <div id="searchResults" class="absolute z-50 w-full mt-2 bg-white rounded-xl shadow-xl border border-gray-100 hidden overflow-hidden">
        <div id="resultsList" class="max-h-60 overflow-y-auto">
            </div>
    </div>
</div>
        
      <div id="sidebar"
        class="fixed top-0 left-0 w-72 h-full bg-white shadow-xl
         transform -translate-x-full transition-transform duration-300 z-50">

        <div class="p-6 border-b">
       <p class="text-sm text-gray-500">Account</p>
       <p id="sidebarUserName" class="font-semibold text-gray-800">
       Loading...
       </p>
        </div>

  <ul class="p-4 space-y-2">
    <li>
      <a href="/notifications"
        class="block px-3 py-2 rounded hover:bg-gray-100">
        üîî Notifications
      </a>
    </li>

    <li>
      <a href="/achievements"
        class="block px-3 py-2 rounded hover:bg-gray-100">
        üèÜ Achievements
      </a>
    </li>

    <li>
      <a href="/account.html"
        class="block px-3 py-2 rounded hover:bg-gray-100 ">
        ‚öôÔ∏è Manage Personal Account
      </a>
    </li>
  </ul>
</div>

         <nav class="flex items-center justify-between bg-white px-6 py-4 shadow">
    
    </nav>
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden z-40"></div>

    <script>
     const settingsBtn = document.getElementById("settingsBtn");
     const sidebar = document.getElementById("sidebar");
     const overlay = document.getElementById("overlay");

     settingsBtn.addEventListener("click", () => {
     sidebar.classList.toggle("-translate-x-full");
     overlay.classList.toggle("hidden");
});

overlay.addEventListener("click", () => {
  sidebar.classList.add("-translate-x-full");
  overlay.classList.add("hidden");
});

</script>
    

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// 1. Firebase Configuration
const firebaseConfig = {
    apiKey: "AIzaSyAlpEfar5odDfV9c2bbmaIpAt5fJJfbez4",
    authDomain: "software-peer-support.firebaseapp.com",
    projectId: "software-peer-support",
    storageBucket: "software-peer-support.firebasestorage.app",
    messagingSenderId: "43088815786",
    appId: "1:43088815786:web:4332760b0fef1b7ae152d3"
};

// 2. Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// 3. Search Bar Elements
const searchInput = document.getElementById('searchInput');
const searchResults = document.getElementById('searchResults');
const resultsList = document.getElementById('resultsList');

// 4. Search Functionality
searchInput.addEventListener('input', async (e) => {
    const term = e.target.value.toLowerCase().trim();

    // Get your own UID from storage
    const myUid = sessionStorage.getItem("uid") || localStorage.getItem("uid");
    
    if (term.length < 1) {
        searchResults.classList.add('hidden');
        return;
    }

    try {
        // This fetches all students to filter them
        const querySnapshot = await getDocs(collection(db, "students"));
        let matches = [];

        querySnapshot.forEach((doc) => {

            const userId = doc.id;
            if (userId === myUid) return; // Skips your own account
            const user = doc.data();
            const firstName = user.firstName || "";
            const lastName = user.lastName || "";
            const fullName = `${firstName} ${lastName}`.toLowerCase();
            
            if (fullName.includes(term)) {
                matches.push({ id: userId, ...user });
            }
        });

        renderResults(matches);
    } catch (err) {
        console.error("Search error:", err);
    }
});

function renderResults(users) {
    resultsList.innerHTML = "";
    
    if (users.length === 0) {
        resultsList.innerHTML = `<p class="p-4 text-sm text-gray-500 text-center">No accounts found.</p>`;
    } else {
        users.forEach(user => {
            const div = document.createElement('div');
            div.className = "flex items-center gap-3 p-3 hover:bg-gray-100 cursor-pointer transition-colors border-b last:border-0";
            div.innerHTML = `
                <img src="${user.profilePic || 'https://via.placeholder.com/40'}" class="w-10 h-10 rounded-full object-cover">
                <div>
                    <p class="font-bold text-sm text-gray-800">${user.firstName || 'User'} ${user.lastName || ''}</p>
                    <p class="text-xs text-gray-500">View Profile</p>
                </div>
            `;
            // This assumes you have a profile.html page
            div.onclick = () => window.location.href = `profile.html?id=${user.id}`;
            resultsList.appendChild(div);
        });
    }
    searchResults.classList.remove('hidden');
}

// Close search if clicking outside
document.addEventListener('click', (e) => {
    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
        searchResults.classList.add('hidden');
    }
});

// 5. Sidebar Loading (Fixed your "Loading..." issue)
window.addEventListener("DOMContentLoaded", async () => {
    const sidebarUserName = document.getElementById("sidebarUserName");
    let uid = sessionStorage.getItem("uid") || localStorage.getItem("uid");
    let role = sessionStorage.getItem("role") || localStorage.getItem("role");

    if (!uid || !role) {
        sidebarUserName.textContent = "Guest";
        return;
    }

    const collectionName = {
        "student": "students",
        "counsellor": "counsellors",
        "moderator": "moderators",
        "admin": "admins"
    }[role] || "students";

    try {
        const docRef = doc(db, collectionName, uid);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
            const data = docSnap.data();
            sidebarUserName.textContent = `${data.firstName || ''} ${data.lastName || ''}`;
        } else {
            sidebarUserName.textContent = "Unknown User";
        }
    } catch (err) {
        console.error("Error loading user:", err);
        sidebarUserName.textContent = "Error";
    }
});
</script>



<!-- ------------------------------------------------------------------------------------------------------------------------------------ Backup -->

        <!-- Left: User Icon
        <div class="flex items-center">
            Box / User Icon -->
            <!-- <div id="settingsBtn"
            class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-200 cursor-pointer hover:bg-gray-300">
            ‚öôÔ∏è
           </div>

        </div> -->
    
        <!-- Right: Menu Items
        <div class="flex space-x-6">
            <a href="#" class="text-gray-700 hover:text-blue-600 font-medium">
                Home
            </a>
            <a href="#" class="text-gray-700 hover:text-blue-600 font-medium">
                About
            </a>
        </div> -->

 <!-- <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"; // Changed

// const db = getFirestore();
// const searchInput = document.getElementById('searchInput');
// const searchResults = document.getElementById('searchResults');
// const resultsList = document.getElementById('resultsList');

// // Trigger on typing
// searchInput.addEventListener('input', async (e) => {
//     const term = e.target.value.toLowerCase().trim();
    
//     if (term.length < 1) {
//         searchResults.classList.add('hidden');
//         return;
//     }

//     // 1. Fetch users from your collection (e.g., "students")
//     const querySnapshot = await getDocs(collection(db, "students"));
//     let matches = [];

//     querySnapshot.forEach((doc) => {
//         const user = doc.data();
//         const fullName = `${user.firstName} ${user.lastName}`.toLowerCase();
        
//         if (fullName.includes(term)) {
//             matches.push({ id: doc.id, ...user });
//         }
//     });

//     // 2. Display Results
//     renderResults(matches);
// });

// function renderResults(users) {
//     resultsList.innerHTML = "";
//     if (users.length === 0) {
//         resultsList.innerHTML = `<p class="p-4 text-sm text-gray-500 text-center">No accounts found.</p>`;
//     } else {
//         users.forEach(user => {
//             const div = document.createElement('div');
//             div.className = "flex items-center gap-3 p-3 hover:bg-gray-50 cursor-pointer transition-colors";
//             div.innerHTML = `
//                 <img src="${user.profilePic || 'https://via.placeholder.com/40'}" class="w-10 h-10 rounded-full object-cover">
//                 <div>
//                     <p class="font-bold text-sm text-gray-800">${user.firstName} ${user.lastName}</p>
//                     <p class="text-xs text-gray-500">@${user.firstName.toLowerCase()}${user.lastName.toLowerCase()}</p>
//                 </div>
//             `;
//             // Redirect to their profile when clicked
//             div.onclick = () => window.location.href = `profile.html?id=${user.id}`;
//             resultsList.appendChild(div);
//         });
//     }
//     searchResults.classList.remove('hidden');
// }

// // Hide dropdown if user clicks outside
// document.addEventListener('click', (e) => {
//     if (!searchInput.contains(e.target)) searchResults.classList.add('hidden');
// }); // End of search script

window.addEventListener("DOMContentLoaded", async () => {
  const sidebarUserName = document.getElementById("sidebarUserName");

  // Firebase config (same as your login page)
  const firebaseConfig = {
    apiKey: "AIzaSyAlpEfar5odDfV9c2bbmaIpAt5fJJfbez4",
    authDomain: "software-peer-support.firebaseapp.com",
    projectId: "software-peer-support",
    storageBucket: "software-peer-support.firebasestorage.app",
    messagingSenderId: "43088815786",
    appId: "1:43088815786:web:4332760b0fef1b7ae152d3"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // get uid and role from sessionStorage, fallback to localStorage
  let uid = sessionStorage.getItem("uid") || localStorage.getItem("uid");
  let role = sessionStorage.getItem("role") || localStorage.getItem("role");

  if (!uid || !role) {
    sidebarUserName.textContent = "Guest";
    return;
  }

  const collection = {
    "student": "students",
    "counsellor": "counsellors",
    "moderator": "moderators",
    "admin": "admins"
  }[role] || "students";

  try {
    const docRef = doc(db, collection, uid);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const data = docSnap.data();
      sidebarUserName.textContent = `${data.firstName} ${data.lastName}`;
    } else {
      sidebarUserName.textContent = "Unknown User";
    }
  } catch (err) {
    console.error("Error loading user:", err);
    sidebarUserName.textContent = "Guest";
  }
});
</script>
    
  </body>
</html> -->
